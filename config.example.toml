[llm]
# DeepSeek V3.2 aliases
base_model = "deepseek-chat"
max_think_model = "deepseek-reasoner"
provider = "deepseek"
profile = "v3_2"
context_window_tokens = 1000000
temperature = 0.2
endpoint = "https://api.deepseek.com/chat/completions"
# Optional workspace-local key override (prefer env in CI/prod):
# api_key = "dsk-..."
api_key_env = "DEEPSEEK_API_KEY"
fast_mode = false
language = "en"
prompt_cache_enabled = true
timeout_seconds = 60
max_retries = 3
retry_base_ms = 400
stream = true

[router]
auto_max_think = true
threshold_high = 0.72
escalate_on_invalid_plan = true
max_escalations_per_unit = 1
# Unified thinking + tools (DeepSeek V3.2): use deepseek-chat with thinking
# mode enabled alongside tools in a single API call.
unified_thinking_tools = true
# Mode router: selects between V3_AUTOPILOT and R1_DRIVE_TOOLS.
# V3_AUTOPILOT is the default (deepseek-chat with unified thinking + tools).
# R1_DRIVE_TOOLS escalates to deepseek-reasoner driving tools via JSON intents.
mode_router_enabled = true
# Break-glass toggle: allow automatic R1DriveTools escalation.
# Default false keeps R1 in consultation mode unless explicitly enabled.
r1_drive_auto_escalation = false
# Max consecutive step failures before escalating from V3 to R1.
v3_max_step_failures = 2
# Max files changed without verification before escalating.
blast_radius_threshold = 5
# Allow V3 one recovery attempt for compile/lint/dependency errors.
v3_mechanical_recovery = true
# Max R1 drive-tools steps per task.
r1_max_steps = 30
# Max retries when R1 output fails JSON schema validation.
r1_max_parse_retries = 2
# Max context requests from V3 patch writer.
v3_patch_max_context_requests = 3
w1 = 0.2
w2 = 0.15
w3 = 0.2
w4 = 0.15
w5 = 0.2
w6 = 0.1

[policy]
approve_edits = "ask"
approve_bash = "ask"
allowlist = ["rg", "git status", "git diff", "git show", "cargo test", "cargo fmt --check", "cargo clippy"]
block_paths = [".env", ".ssh", ".aws", ".gnupg", "**/id_*", "**/secret"]
redact_patterns = [
  "(?i)(api[_-]?key|token|secret|password)\\s*[:=]\\s*['\\\"]?[a-z0-9_\\-]{8,}['\\\"]?",
  "\\b\\d{3}-\\d{2}-\\d{4}\\b",
  "(?i)\\b(mrn|medical_record_number|patient_id)\\s*[:=]\\s*[a-z0-9\\-]{4,}\\b",
]
sandbox_mode = "allowlist"
# Optional OS-level sandbox wrapper for `sandbox_mode = "isolated"`:
# sandbox_wrapper = "bwrap --die-with-parent --new-session --unshare-all --bind {workspace} {workspace} --chdir {workspace} /bin/sh -lc {cmd}"
sandbox_wrapper = ""
# Optional: auto-lint after fs.edit (from Aider). Lint output included in tool result.
# lint_after_edit = "cargo fmt --check"

[tools.chrome]
# Strict-live by default. Set true only for offline deterministic test flows.
allow_stub_fallback = false

[plugins]
enabled = true
search_paths = [".deepseek/plugins", ".plugins"]
enable_hooks = false

[plugins.catalog]
enabled = true
index_url = ".deepseek/plugins/catalog.json"
signature_key = "deepseek-local-dev-key"
refresh_hours = 24

[skills]
paths = [".deepseek/skills", "~/.deepseek/skills"]
hot_reload = true

[usage]
show_statusline = true
cost_per_million_input = 0.27
cost_per_million_output = 1.10

[context]
auto_compact_threshold = 0.86
compact_preview = true

[autopilot]
default_max_consecutive_failures = 10
heartbeat_interval_seconds = 5
persist_checkpoints = true

[scheduling]
off_peak = false
off_peak_start_hour = 0
off_peak_end_hour = 6
defer_non_urgent = false
max_defer_seconds = 0

[replay]
strict_mode = true

[ui]
enable_tui = true
keybindings_path = "~/.deepseek/keybindings.json"
reduced_motion = false
statusline_mode = "minimal"
# Fallback mode when terminal cannot render inline images: open | path | none
image_fallback = "open"
# Optional base URL for teleport handoff links (used by `teleport link`)
# handoff_base_url = "https://app.example.com/handoff"

[experiments]
visual_verification = false
wasm_hooks = false

[telemetry]
enabled = false
# endpoint = "https://telemetry.example.com/deepseek"

[index]
enabled = true
engine = "tantivy"
watch_files = true

[budgets]
max_turn_duration_secs = 300
max_reasoner_tokens_per_session = 1000000

[theme]
primary = "Cyan"
secondary = "Yellow"
error = "Red"
